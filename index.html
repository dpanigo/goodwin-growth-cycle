<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goodwin Growth Cycle Model</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
            padding: 20px;
        }

        .controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .control-section {
            margin-bottom: 25px;
        }

        .control-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.1em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .parameter {
            margin-bottom: 15px;
        }

        .parameter label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .parameter input[type="number"],
        .parameter input[type="range"] {
            width: 100%;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .parameter input[type="range"] {
            padding: 0;
            margin-top: 5px;
        }

        .parameter .value-display {
            display: inline-block;
            min-width: 60px;
            text-align: right;
            font-weight: bold;
            color: #667eea;
        }

        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .plots {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .plot-container {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .equilibrium-info {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid #667eea;
        }

        .equilibrium-info h4 {
            color: #667eea;
            margin-bottom: 8px;
        }

        .equilibrium-info p {
            margin: 5px 0;
            font-family: monospace;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-size: 18px;
        }

        .loading.active {
            display: block;
        }

        @media (max-width: 1024px) {
            .content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Goodwin Growth Cycle Model</h1>
            <p class="subtitle">Interactive Economics Simulation (1965)</p>
        </header>

        <div class="content">
            <div class="controls">
                <div class="control-section">
                    <h3>Model Parameters</h3>

                    <div class="parameter">
                        <label>œÉ (Capital-Output Ratio): <span class="value-display" id="sigma-val">0.90</span></label>
                        <input type="range" id="sigma" min="0.5" max="2.0" step="0.01" value="0.90">
                    </div>

                    <div class="parameter">
                        <label>Œ± (Productivity Growth): <span class="value-display" id="alpha-val">0.020</span></label>
                        <input type="range" id="alpha" min="0.001" max="0.1" step="0.001" value="0.020">
                    </div>

                    <div class="parameter">
                        <label>Œ≤ (Labor Force Growth): <span class="value-display" id="beta-val">0.020</span></label>
                        <input type="range" id="beta" min="0.001" max="0.1" step="0.001" value="0.020">
                    </div>

                    <div class="parameter">
                        <label>Œ≥ (Wage Adjustment Constant): <span class="value-display" id="gamma-val">0.020</span></label>
                        <input type="range" id="gamma" min="0.001" max="0.1" step="0.001" value="0.020">
                    </div>

                    <div class="parameter">
                        <label>œÅ (Wage Sensitivity): <span class="value-display" id="rho-val">0.040</span></label>
                        <input type="range" id="rho" min="0.001" max="0.2" step="0.001" value="0.040">
                    </div>
                </div>

                <div class="control-section">
                    <h3>Initial Conditions</h3>

                    <div class="parameter">
                        <label>v‚ÇÄ (Initial Employment Rate): <span class="value-display" id="v0-val">0.90</span></label>
                        <input type="range" id="v0" min="0.1" max="1.0" step="0.01" value="0.90">
                    </div>

                    <div class="parameter">
                        <label>u‚ÇÄ (Initial Wage Share): <span class="value-display" id="u0-val">0.70</span></label>
                        <input type="range" id="u0" min="0.1" max="1.0" step="0.01" value="0.70">
                    </div>

                    <div class="parameter">
                        <label>Simulation Time: <span class="value-display" id="tmax-val">200</span></label>
                        <input type="range" id="tmax" min="50" max="500" step="10" value="200">
                    </div>
                </div>

                <button onclick="runSimulation()">‚ñ∂ Run Simulation</button>

                <div class="equilibrium-info">
                    <h4>Equilibrium Point</h4>
                    <p id="eq-v">v* = -</p>
                    <p id="eq-u">u* = -</p>
                </div>
            </div>

            <div class="plots">
                <div class="loading" id="loading">‚è≥ Running simulation...</div>

                <div class="plot-container">
                    <div id="time-plot" style="width:100%; height:400px;"></div>
                </div>

                <div class="plot-container">
                    <div id="phase-plot" style="width:100%; height:400px;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Update value displays when sliders change
        const params = ['sigma', 'alpha', 'beta', 'gamma', 'rho', 'v0', 'u0', 'tmax'];
        params.forEach(param => {
            const slider = document.getElementById(param);
            const display = document.getElementById(param + '-val');
            slider.addEventListener('input', () => {
                let val = parseFloat(slider.value);
                display.textContent = param === 'tmax' ? val.toFixed(0) : val.toFixed(3);
            });
        });

        // Run simulation on page load
        window.addEventListener('load', () => {
            runSimulation();
        });

        async function runSimulation() {
            // Show loading
            document.getElementById('loading').classList.add('active');

            // Get parameter values
            const requestData = {
                sigma: parseFloat(document.getElementById('sigma').value),
                alpha: parseFloat(document.getElementById('alpha').value),
                beta: parseFloat(document.getElementById('beta').value),
                gamma: parseFloat(document.getElementById('gamma').value),
                rho: parseFloat(document.getElementById('rho').value),
                v0: parseFloat(document.getElementById('v0').value),
                u0: parseFloat(document.getElementById('u0').value),
                t_max: parseFloat(document.getElementById('tmax').value)
            };

            try {
                // Call API
                const response = await fetch('/simulate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) {
                    throw new Error('Simulation failed');
                }

                const data = await response.json();

                // Update equilibrium display
                document.getElementById('eq-v').textContent = `v* = ${data.v_eq.toFixed(4)}`;
                document.getElementById('eq-u').textContent = `u* = ${data.u_eq.toFixed(4)}`;

                // Plot time series
                plotTimeSeries(data);

                // Plot phase diagram
                plotPhaseDiagram(data);

                // Hide loading
                document.getElementById('loading').classList.remove('active');

            } catch (error) {
                console.error('Error:', error);
                alert('Simulation failed. Please try again.');
                document.getElementById('loading').classList.remove('active');
            }
        }

        function plotTimeSeries(data) {
            const trace1 = {
                x: data.t,
                y: data.v,
                name: 'Employment Rate (v)',
                type: 'scatter',
                line: { color: '#667eea', width: 2 }
            };

            const trace2 = {
                x: data.t,
                y: data.u,
                name: 'Wage Share (u)',
                type: 'scatter',
                line: { color: '#764ba2', width: 2 }
            };

            const trace3 = {
                x: data.t,
                y: data.profits,
                name: 'Profits (1-u)',
                type: 'scatter',
                line: { color: '#f093fb', width: 2, dash: 'dash' }
            };

            const layout = {
                title: 'Time Dynamics',
                xaxis: { title: 'Time' },
                yaxis: { title: 'Value' },
                hovermode: 'x unified',
                showlegend: true,
                legend: { x: 1, xanchor: 'right', y: 1 }
            };

            Plotly.newPlot('time-plot', [trace1, trace2, trace3], layout, { responsive: true });
        }

        function plotPhaseDiagram(data) {
            const trace1 = {
                x: data.v,
                y: data.u,
                name: 'Trajectory',
                type: 'scatter',
                mode: 'lines',
                line: { color: '#667eea', width: 2 }
            };

            const trace2 = {
                x: [data.v_eq],
                y: [data.u_eq],
                name: 'Equilibrium',
                type: 'scatter',
                mode: 'markers',
                marker: { color: '#ff6b6b', size: 12, symbol: 'x' }
            };

            const layout = {
                title: 'Phase Diagram',
                xaxis: { title: 'Employment Rate (v)' },
                yaxis: { title: 'Wage Share (u)' },
                showlegend: true,
                legend: { x: 1, xanchor: 'right', y: 1 }
            };

            Plotly.newPlot('phase-plot', [trace1, trace2], layout, { responsive: true });
        }
    </script>
</body>
</html>
